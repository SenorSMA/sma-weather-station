<html>
    <head>
        <meta charset="utf-8" />
        <title>SMA Weather</title>
        <style>
            body {
                background-image: linear-gradient(rgba(240, 221, 180, 0.90), rgba(240, 221, 180, 0.65)), url('aztec-background.jpg');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
                background-attachment: fixed;
                font-family: Georgia, 'Times New Roman', serif;
                font-size: 27pt;
                color: #000000;
            }
            
            button { border: none; color: white; padding: 10px 16px; text-align: center; text-decoration: none; display: inline-block; font-size: 36pt; }
            ol { margin-left: 20pt; }
            .h3-style { font-size: 36pt; font-weight: bold;}
            .layout {
                display: grid;
                grid-template-rows: auto;
                grid-template-columns: 100%;
                grid-template-areas:
                    "header"
                    "current"
                    "forecast"
                    "footer";
                grid-gap: 10px;
            }

            option { font-family: Arial, Helvetica, Sans-Serif; font-size: 27pt; }
            selection { font-family: Arial, Helvetica, Sans-Serif; font-size: 27pt; }

            .item-header { grid-area: header; padding-top: 1em; padding-left: 2em; padding-right: 2em; }
            .item-current { grid-area: current; padding-left: 2em; padding-right: 2em; }
            .item-forecast { grid-area: forecast; padding-left: 2em; padding-right: 2em; }
            .item-footer { grid-area: footer; padding-left: 2em; padding-right: 2em; }

            table { margin-left:2em; }
            td { font-size: 27pt; padding-right: 20px; padding-bottom: 10px; }
            .forecast-table td { font-size: 27pt; padding: 10px; background-color:#F6F6F6; }
            .forecast-weekend-row td { font-size: 27pt; padding: 10px; background-color:#E6E6E6; }
            
            #weather-table {
                border-spacing: 0;
                width: 90%;
                margin: 0 auto;
            }

            #weather-table tr {
                border-bottom: none;
            }

            #weather-table td {
                padding: 15px 20px;
                color: #5a4a3a;
                border: none;
            }
            
            #weather-table td:last-child {
                text-align: right;
            }

            .banner {
                background: linear-gradient(135deg, rgba(212, 165, 116, 0.3) 0%, rgba(200, 150, 102, 0.3) 100%);
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
                position: relative;
            }

            .banner h1 {
                font-size: 135%;
                color: #5a4a3a;
                margin: 0 0 10px 0;
                text-align: center;
            }

            .banner p {
                font-size: 60%;
                color: #5a4a3a;
                margin: 0;
                text-align: center;
            }

            .language-selector {
                position: absolute;
                top: 30px;
                right: 30px;
            }
        </style>
    </head>
    <body>
        <div class="layout">
            <div class="item-header">
                <div class="banner">
                    <h1>SMA Weather</h1>
                    <p>Central Mexico 6,614 ft</p>
                    <div class="language-selector">
                        <button id="lang-toggle" onclick="toggleLanguage()" style="background: transparent; border: 2px solid #5a4a3a; border-radius: 8px; padding: 5px; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 50px; height: 40px;">
                            <img id="flag-img" src="https://flagcdn.com/w40/us.png" alt="Language" style="width: 30px; height: auto;">
                        </button>
                    </div>
                </div>
                <p id="message" hidden></p>
            </div>
            <div class="item-current">
                <h3 style="font-size: 72%; text-align: center; color: #5a4a3a;" data-translate="current-conditions">Current Conditions</h3>
                <table id="weather-table">
                     <tr>
                        <td style="text-align:center"><img src="temperature.png" height="80"></td>
                        <td data-translate="temperature">Temperature</td>
                        <td><span id="temperature">-</span></td>
                      </tr>
                     <tr>
                        <td style="text-align:center"><img src="humidity.png" height="80"></td>
                        <td data-translate="humidity">Humidity</td>
                        <td> <span id="humidity">-</span></td>
                      </tr>
                     <tr>
                        <td style="text-align:center"><img src="pressure.png" height="80"></td>
                        <td data-translate="pressure">Pressure</td>
                        <td> <span id="pressure">-</span></td>
                      </tr>
                     <tr>
                        <td style="text-align:center"><img src="rain.png" height="80"></td>
                        <td data-translate="rain">Rain</td>
                        <td> <span id="rain">-</span></td>
                      </tr>
                     <tr>
                        <td style="text-align:center"><img src="wind.png" height="80"></td>
                        <td data-translate="wind">Wind</td>
                        <td><span id="wind">-</span></td>
                      </tr>
                     <tr>
                        <td style="text-align:center"><img src="battery.png" height="80"></td>
                        <td data-translate="battery">Battery</td>
                        <td><span id="batterypercentage">-</span></td>
                      </tr>
                     <tr>
                        <td style="text-align:center"><img src="sun.png" height="80"></td>
                        <td data-translate="sun">Sun</td>
                        <td><span id="sun">-</span></td>
                      </tr>
                     <tr>
                        <td style="text-align:center"><img src="updated.png" height="80"></td>
                        <td data-translate="datetime">Date/Time</td>
                        <td><span id="updated">-</span> <span id="offline"></span></td>
                      </tr>
                </table>
            </div>
            <div class="item-forecast" id="item_forecast" hidden>
                <h3 data-translate="forecast">Forecast</h3>
                <table id="forecast-table" class="forecast-table">
                </table>
                <p><em data-translate="data-from">Data from</em> <span id="station">-</span> (<a target="_blank" rel="noopener noreferrer" href="http://openweathermap.org">openweathermap.org</a>)</p>
            </div>
            <div class="item-footer">
                <p style="font-size: 40%; text-align: center; color: #5a4a3a;">&copy; 2026 SMA Weather</p>
            </div>
        </div>

        <script>

            let windDirectionsArray = [ ['N', 'North'], ['NNE', 'North-Northeast'], ['NE', 'Northeast'], ['ENE', 'East-Northeast'],
                    ['E', 'East'], ['ESE', 'East-Southeast'], ['SE', 'Southeast'], ['SSE', 'South-Southeast'],
                    ['S', 'South'], ['SSW', 'South-Southwest'], ['SW', 'Southwest'], ['WSW', 'West-Southwest'],
                    ['W', 'West'], ['WNW', 'West-Northwest'], ['NW', 'Northwest'], ['NNW', 'North-Northwest'] ];

            let windDirections = new Map(windDirectionsArray);

            let windSpeedUnit = "mph";

            const coloredtemperatures = true;
            const forcasttabled = true;

            function getForecastDataWithConfiguration(latitude, longitude, numdays, apikey) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {

                        var jsonObj = JSON.parse(this.responseText);

                        var table = "";

                        const dateoptions = { weekday: 'short', day: 'numeric' };
                        const todaydate = new Date();
                        const todaydatestr = todaydate.toLocaleDateString('en-US', dateoptions);
                        const tomorrowdate = new Date();
                        tomorrowdate.setDate(tomorrowdate.getDate() + 1);
                        const tomorrowdatestr = tomorrowdate.toLocaleDateString('en-US', dateoptions);

                        document.getElementById("station").innerHTML = jsonObj.city.name;

                        for (let i = 0; i < jsonObj.list.length; i++) {

                            var datestr = new Date(jsonObj.list[i].dt*1000).toLocaleDateString('en-US', dateoptions);
                            var dayofweek = new Date(jsonObj.list[i].dt*1000).getDay();

                            if (datestr==todaydatestr)
                                datestr = "Today";
                            else if (datestr==tomorrowdatestr)
                                datestr = "Tomorrow";

                            table += (dayofweek==0||dayofweek==6)?"<tr class='forecast-weekend-row'>":"<tr>";
                            table += "<td><nobr>" + datestr + "</nobr></td>";

                            if (jsonObj.list[i].weather[0].icon.endsWith("d"))
                                table += "<td><img src='WeatherIcon" + jsonObj.list[i].weather[0].icon + ".png' height='80'></td>";
                            else
                                table += "<td><img src='WeatherIcon" + jsonObj.list[i].weather[0].icon.slice(0, -1) + "d.png' height='80'></td>";

                            var temp = "-";
                            temp = ((jsonObj.list[i].temp.max * 9/5) + 32).toFixed(0) + "/" + ((jsonObj.list[i].temp.min * 9/5) + 32).toFixed(0) + " &#8457;";
                            table += "<td><nobr>" + temp + "</nobr></td>";

                            var windspeed = "-";
                            var windspeedval = jsonObj.list[i].speed;
                            switch(windSpeedUnit) {
                                case "mph":
                                    if (windspeedval!="-")
                                        windspeed = (windspeedval * 2.23694).toFixed(1) + " mph";
                                    break;
                                case "m/s":
                                    if (windspeedval!="-")
                                        windspeed = windspeedval.toFixed(1) + " <sup>m</sup>&frasl;<sub>s</sub>";
                                    break;
                                case "kn":
                                    if (windspeedval!="-")
                                        windspeed = (windspeedval * 1.94384).toFixed(1) + " kn";
                                    break;
                            }

                            if (jsonObj.list[i].deg!="-") {
                                windspeed += " <img src='wind";
                                var winddeg = jsonObj.list[i].deg;
                                var windabbr = [ 'N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW' ];
                                var windindex = Math.round(((winddeg %= 360) < 0 ? winddeg + 360 : winddeg) / 22.5) % 16;
                                windspeed += windabbr[windindex] + ".png' height='32'> <nobr>" + windabbr[windindex] + "</nobr>";
                            }

                            table += "<td>" + windspeed + "</td>";

                            var rain = "-";
                            if (jsonObj.list[i].rain!=undefined)
                                rain = jsonObj.list[i].rain.toFixed(1) + " mm";
                            if (rain!="-")
                                table += "<td><img src='raindrop.png' height='40' style='vertical-align:middle'> " + rain + "</td>";
                            else
                                table += "<td>" + rain + "</td>";

                            table += "</tr>\n";
                        }

                        document.getElementById("forecast-table").innerHTML = table;
                        document.getElementById("item_forecast").hidden = false;
                    }
                };

                xhttp.open("GET", "https://api.openweathermap.org/data/2.5/forecast/daily?lat=" + latitude + "&lon=" + longitude + "&cnt=" + numdays + "&appid=" + apikey + "&units=metric", true);
                xhttp.send();
            }

            function getForecastData() {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var jsonObj = JSON.parse(this.responseText);
                        if (jsonObj.latitude==undefined||jsonObj.latitude==0)
                            document.getElementById("item_forecast").hidden = true;
                        else
                            getForecastDataWithConfiguration(jsonObj.latitude, jsonObj.longitude, jsonObj.numdays, jsonObj.apikey);
                    }
                };
                xhttp.open("GET", "forecast-configuration.json", true);
                xhttp.send();
            }

            function getWeatherData() {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var jsonObj = JSON.parse(this.responseText);

                        if (jsonObj.message!=undefined&&jsonObj.message!="")
                            document.getElementById("message").innerHTML = jsonObj.message;
                        else
                            document.getElementById("message").hidden = true;

                        var temperature = "-";

                        if (jsonObj.weather.temperature!="-") {
                            var tempF = (parseFloat(jsonObj.weather.temperature) * 9/5 + 32).toFixed(1);
                            temperature = tempF + " &#8457;";

                            if (jsonObj.aggregated.mintemperature!="-"&&jsonObj.aggregated.maxtemperature!="-") {
                                var minF = (parseFloat(jsonObj.aggregated.mintemperature) * 9/5 + 32).toFixed(0);
                                var maxF = (parseFloat(jsonObj.aggregated.maxtemperature) * 9/5 + 32).toFixed(0);
                                if (coloredtemperatures) {
                                    temperature = temperature + " (<span style='color:#5b7c99'>&mapstodown;" + minF + "</span> <span style='color:#b85042'>&mapstoup;" + maxF + "</span>)"

                                } else {
                                    temperature = temperature + " (&mapstodown;" + minF + " &mapstoup;"  + maxF + ")"
                                }
                            }
                        }
                        document.getElementById("temperature").innerHTML = temperature;

                        document.getElementById("humidity").innerHTML = jsonObj.weather.humidity=="-"?"-":jsonObj.weather.humidity + " %rH";

                        var pressure = "-";

                        if (jsonObj.weather.pressure!="-") {
                            var pressureInHg = (parseFloat(jsonObj.weather.pressure) * 0.02953).toFixed(2);
                            pressure = pressureInHg + " inHg"
                            if (jsonObj.aggregated.barotrend!="-") {
                                if (jsonObj.aggregated.barotrend>1)
                                    pressure = pressure + " rising";
                                else if (jsonObj.aggregated.barotrend<-1)
                                    pressure = pressure + " falling";
                            }
                        }
                        document.getElementById("pressure").innerHTML = pressure;

                        var rain = "-";

                        if (jsonObj.aggregated.rainhour=="-")
                            rain = "-";
                        else {
                            rain = jsonObj.aggregated.rainhour + " <sup>mm</sup>&frasl;<sub>h</sub>";

                            if (jsonObj.aggregated.rainday!="-")
                                rain = rain + ", " + jsonObj.aggregated.rainday + " <sup>mm</sup>&frasl;<sub>day</sub>";
                        }
                        document.getElementById("rain").innerHTML = rain;

                        var wind = "-";

                        if (jsonObj.aggregated.windmps=="-")
                            if (jsonObj.weather.winddirection=="-")
                                wind = "-";
                            else
                                wind = jsonObj.weather.winddirection;
                        else {
                            switch(windSpeedUnit) {
                                case "mph":
                                    if (jsonObj.aggregated.windmph!="-")
                                        wind = jsonObj.aggregated.windmph;
                                    else
                                        wind = (parseFloat(jsonObj.aggregated.windmps) * 2.23694).toFixed(1);
                                    break;
                                case "m/s":
                                    wind = jsonObj.aggregated.windmps;
                                    break;
                                case "kn":
                                    wind = jsonObj.aggregated.windknots;
                                    break;
                            }

                            var htmlWindSpeedUnit = windSpeedUnit

                            if (htmlWindSpeedUnit=="m/s")
                                htmlWindSpeedUnit = "<sup>m</sup>&frasl;<sub>s</sub>"
                                wind = wind + " <button style='background-color: #5b7c99; font-size: 16pt; padding: 0px; border-radius: 50%; width: 48px; height: 48px; border: none; display: inline-flex; align-items: center; justify-content: center; line-height: 1;' type='button' onclick='changeWindSpeedUnit()'>" + htmlWindSpeedUnit + "</button>";

                            switch(windSpeedUnit) {
                                case "mph":
                                    var gustsMph = "-";
                                    if (jsonObj.aggregated.gustsmph!="-")
                                        gustsMph = jsonObj.aggregated.gustsmph;
                                    else if (jsonObj.aggregated.gustsmps!="-")
                                        gustsMph = (parseFloat(jsonObj.aggregated.gustsmps) * 2.23694).toFixed(1);
                                    if (gustsMph!="-"&&gustsMph!=wind.split(" ")[0])
                                        wind = wind + " (gusts " + gustsMph + ")";
                                    break;
                                case "m/s":
                                    if (jsonObj.aggregated.gustsmps!="-"&&jsonObj.aggregated.gustsmps!=jsonObj.aggregated.windmps)
                                        wind = wind + " (gusts " + jsonObj.aggregated.gustsmps + ")";
                                    break;
                                case "kn":
                                    if (jsonObj.aggregated.gustsknots!="-"&&jsonObj.aggregated.gustsknots!=jsonObj.aggregated.windknots)
                                        wind = wind + " (gusts " + jsonObj.aggregated.gustsknots + ")";
                                    break;
                            }

                            if (jsonObj.weather.winddirection!="-") {
                                wind += " <img src='wind" + jsonObj.weather.winddirection + ".png' height='32' style='vertical-align:middle'>&nbsp;";
                                wind += jsonObj.weather.winddirection;
                            }
                        }
                        document.getElementById("wind").innerHTML = wind;

                        var sun = "-";

                        if (jsonObj.sun.azimuth=="-"||jsonObj.sun.inclination=="-")
                            sun = "-";
                        else
                            sun = "<img src='inclination.png' height='32' style='vertical-align:middle'> " + jsonObj.sun.inclination + "&deg; <img src='azimuth.png' height='40' style='vertical-align:middle'> " + jsonObj.sun.azimuth + "&deg;";
                        document.getElementById("sun").innerHTML = sun;

                        document.getElementById("batterypercentage").innerHTML = jsonObj.weather.batterypercentage=="-"?"-":jsonObj.weather.batterypercentage + " %";
                        document.getElementById("updated").innerHTML = jsonObj["updated-de"];

                        if (jsonObj["updated-de"]!="-")
                            if (jsonObj["offline"])
                                document.getElementById("offline").innerHTML = "<img src='RedDot12.png' height='12' style='vertical-align:middle'>";
                            else
                                document.getElementById("offline").innerHTML = "<img src='GreenDot12.png' height='12' style='vertical-align:middle'>";
                        else
                            document.getElementById("offline").innerHTML = "";
                    }
                };
                xhttp.open("GET", "weatherdata.json", true);
                xhttp.send();
            }

            function administration() {
                window.location.href = "administration.html";
            }

            function changeWindSpeedUnit()  {
                switch(windSpeedUnit) {
                    case "mph":
                        windSpeedUnit = "m/s";
                        break;
                    case "m/s":
                        windSpeedUnit = "kn";
                        break;
                    case "kn":
                        windSpeedUnit = "mph";
                        break;
                }
                getWeatherData();
                getForecastData();
            }

            // Language translations
            const translations = {
                en: {
                    'current-conditions': 'Current Conditions',
                    'temperature': 'Temperature',
                    'humidity': 'Humidity',
                    'pressure': 'Pressure',
                    'rain': 'Rain',
                    'wind': 'Wind',
                    'battery': 'Battery',
                    'sun': 'Sun',
                    'datetime': 'Date/Time',
                    'forecast': 'Forecast',
                    'data-from': 'Data from'
                },
                mx: {
                    'current-conditions': 'Condiciones Actuales',
                    'temperature': 'Temperatura',
                    'humidity': 'Humedad',
                    'pressure': 'Presión',
                    'rain': 'Lluvia',
                    'wind': 'Viento',
                    'battery': 'Batería',
                    'sun': 'Sol',
                    'datetime': 'Fecha/Hora',
                    'forecast': 'Pronóstico',
                    'data-from': 'Datos de'
                }
            };

            let currentLanguage = 'en';

            function toggleLanguage() {
                // Toggle between English and Spanish
                currentLanguage = (currentLanguage === 'en') ? 'mx' : 'en';
                
                // Update flag image
                const flagImg = document.getElementById('flag-img');
                if (currentLanguage === 'en') {
                    flagImg.src = 'https://flagcdn.com/w40/us.png';
                } else {
                    flagImg.src = 'https://flagcdn.com/w40/mx.png';
                }
                
                // Update all translatable elements
                document.querySelectorAll('[data-translate]').forEach(element => {
                    const key = element.getAttribute('data-translate');
                    if (translations[currentLanguage] && translations[currentLanguage][key]) {
                        element.textContent = translations[currentLanguage][key];
                    }
                });
            }

            //    one time calls
            setInterval(function() {getWeatherData();}, 20*1000);
            getWeatherData();

            setInterval(function() {getForecastData();}, 15*60*1000 );
            getForecastData();

        </script>
    </body>
</html>
